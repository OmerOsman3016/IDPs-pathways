 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: 'unsafe-inline' 'unsafe-eval'">
  <meta name="description" content="Sudan | Displacement Tracking Matrix-Returnees Flow" />
  
  <!-- External CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="./css/styles.css">

  <!-- External JS -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/esri-leaflet@3.0.0/dist/esri-leaflet.js"></script>
  <script src="https://unpkg.com/@tweenjs/tween.js@18.6.4/dist/tween.umd.js"></script>
  <script src="./src/CanvasFlowmapLayer.js"></script>
  <script src="https://unpkg.com/papaparse@5.3.0/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
</head>

<body>
  <!-- Dashboard Section -->
  <div id="dashboard-section">
    <!-- ... (dashboard content remains unchanged) ... -->
  </div>

  <!-- IDPs Section -->
  <div class="frame-container">
    <!-- ... (IDPs content remains unchanged) ... -->
  </div>

  <!-- Pathways Section -->
  <div class="frame-container">
    <div class="text-container">
      <h2>IDPs Pathways Across Sudan</h2>
      <p>
        This map visualizes the complex movement patterns of Internally Displaced Persons (IDPs) across Sudan...
      </p>
    </div>
    <div class="map-container">
      <div id="map2" class="map"></div>
    </div>
  </div>

  <!-- Other Sections -->
  <!-- ... (other sections remain unchanged) ... -->

  <script>
  // Pathways Map Implementation
  (function() {
    const map2 = L.map('map2').setView([16, 30], L.Browser.mobile ? 3 : 5.5);

    // Base Layers Configuration
    const baseLayers = {
      "CartoDB Light": L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }),
      "ESRI Satellite": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: '&copy; Esri'
      })
    };

    baseLayers["CartoDB Light"].addTo(map2);

    // Layer Control
    L.control.layers(baseLayers).addTo(map2);

    // Flowmap Data Processing
    Papa.parse('./data/data_idps.csv', {
      download: true,
      header: true,
      complete: (results) => {
        const flowLayer = L.canvasFlowmapLayer(results.data, {
          originAndDestinationFieldIds: {
            originUniqueIdField: 's_state_id',
            originGeometry: { x: 's_lon', y: 's_lat' },
            destinationUniqueIdField: 'e_locality_id',
            destinationGeometry: { x: 'e_lon', y: 'e_lat' }
          },
          style: (feature) => ({
            radius: feature.properties.isOrigin ? 12 : 6,
            color: feature.properties.isOrigin ? '#ff671f' : '#418FDE',
            fillOpacity: 0.8
          }),
          canvasBezierStyle: {
            classBreakInfos: [
              { classMaxValue: 10000, symbol: { strokeStyle: '#ffb81c', lineWidth: 0.5 } },
              { classMaxValue: 20000, symbol: { strokeStyle: '#ff671f', lineWidth: 1.5 } },
              { classMaxValue: 200000, symbol: { strokeStyle: '#d22630', lineWidth: 3 } }
            ]
          },
          animationDuration: 3000
        }).addTo(map2);

        // Interactive Features
        flowLayer.on('mouseover', (e) => {
          if (e.sharedOriginFeatures.length) {
            flowLayer.highlightFeatures(e.sharedOriginFeatures);
          }
        });

        flowLayer.on('mouseout', () => {
          flowLayer.resetFeatureHighlights();
        });
      }
    });

    // Legend Implementation
    const legend = L.control({ position: 'bottomright' });
    legend.onAdd = () => {
      const div = L.DomUtil.create('div', 'legend');
      div.innerHTML = `
        <h4>Displacement Volume</h4>
        <div class="legend-item">
          <span class="legend-color" style="background:#ffb81c"></span>
          <span>&lt; 10,000</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background:#ff671f"></span>
          <span>10,000-20,000</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background:#d22630"></span>
          <span>&gt; 20,000</span>
        </div>
      `;
      return div;
    };
    legend.addTo(map2);
  })();

  // Other Map Initializations
  // ... (other map implementations) ...
  </script>

  <!-- Footer and other closing elements -->
  <!-- ... (footer remains unchanged) ... -->
</body>
</html>
